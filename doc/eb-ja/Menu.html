<html lang="en">
<head>
<title>EB Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="EB Library">
<meta name="generator" content="makeinfo 4.5">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home">
</head>
<body>
<div class="node">
<p>
ノード:<a name="Menu">Menu</a>,
次:<a rel="next" accesskey="n" href="Multi-Candidates.html#Multi%20Candidates">Multi Candidates</a>,
前:<a rel="previous" accesskey="p" href="Copyright-Notice.html#Copyright%20Notice">Copyright Notice</a>,
上:<a rel="up" accesskey="u" href="Text-Data.html#Text%20Data">Text Data</a>
<hr><br>
</div>

<h3 class="section">メニュー</h3>

   <p>本文とは独立したテキストデータとしては、著作権表示の他に
<dfn>メニュー (menu)</dfn> というものがあります。
メニューは、主に本文の補助となるデータを収録しています。
代表的なものでは、「前書き (序)」「凡例」といったものが挙げられます。

   <p>メニューでは「別項目参照」というエスケープシーケンスを多用して、階層的
な構造になっているのが一般的です。
このエスケープシーケンスには、参照先のテキストの位置が記録されています。

   <p>たとえば、ある CD-ROM 書籍のメニューが次のようになっていたとします。
この例では、メニューには 3 つの項目があります。

<pre class="example">      * 序文
      * 表記について
      * 奥付
     </pre>

<p>メニューのそれぞれの項目には、参照先があります。
テキストデータの内部表現では、「序文」「表記について」「奥付」の
それぞれの文字列の前後に別項目参照開始および終了エスケープシーケンスが
付いた形になっています。
視覚的に分かるように記すと、次のような形になっています。

<pre class="example">      * &lt;別項目参照開始シーケンス&gt; "序文" &lt;別項目参照終了シーケンス&gt;
      * &lt;別項目参照開始シーケンス&gt; "表記" &lt;別項目参照終了シーケンス&gt;
      * &lt;別項目参照開始シーケンス&gt; "奥付" &lt;別項目参照終了シーケンス&gt;
     </pre>

   <p>HTML の書き方を知っているなら、<code>a</code> タグと言えば分かるのではないか
と思います。

<pre class="example">     &lt;a href="./index-ja.html"&gt;EB ライブラリのホームページ&lt;/a&gt;
     </pre>

   <p>ただし、参照先の位置情報は終了シーケンス側に記載されますので、この点は
HTML とは逆になります。
蛇足ですが、別位置参照はメニューだけでなく、本文でも一般的に使用されます。

   <p>別項目参照開始および終了シーケンスに対して、それぞれフック
<code>EB_HOOK_BEGIN_REFERENCE</code> と <code>EB_HOOK_END_REFERENCE</code> が用意
されています。
参照先の位置情報は、終了シーケンスへのフック関数に対して、引数として
渡されます。
たとえば、<code>EB_HOOK_END_REFERENCE</code> へのフック関数の冒頭では、次の
ようにすると良いかも知れません。

<pre class="example">     EB_Error_Code
     hook_end_ref(EB_Book *book, EB_Appendix *appendix, void *container,
         EB_Hook_Code code, int argc, const unsigned int *argv)
     {
         EB_Position position;
     
         position.page = argv[1];    # 参照先のページ番号
         position.offset = argv[2];  # 参照先のオフセット
     </pre>

   <p>参照先は、メニューの第 2 層となります。
この書籍の「奥付」の参照先を辿ったら、次のような表記になっていました。

<pre class="example">     ○○堂出版社 新国語辞典 第 2 版 (EPWING 版)
     第 1 版 発行 1988年 2月
     第 2 版 発行 1999年 11月
     第 2 版 (EPWING 版) 発行 2000年 2月
     </pre>

<p>同様に「序文」「表記に付いて」の参照先についても、こうした文章データ
が用意されていました。
図示すると、メニューの階層は次のようになります。

<pre class="example">     　　　　　　　　　　　　┌─────┐
     第１層　　　　　　　　　│メニュー　│
     　　　　　　　　　　　　└──┰──┘
     　　　　　　　　　　　　　　　┃
     　　　　　　　┏━━━━━━━╋━━━━━━━┓
     　　　　　　　┃　　　　　　　┃　　　　　　　┃
     　　　　┌──┸──┐　┌──┸──┐　┌──┸──┐
     第２層　│メニュー　│　│メニュー　│　│メニュー　│
     　　　　└─────┘　└─────┘　└─────┘
     </pre>

<p>この辞書の例では、メニューはここで終わりになっていますが、書籍によっては
さらに第 3 層、第 4 層と続く場合もあります。
また、メニュー全体が均一の階層数になっているとは限りません。
メニューの参照先が本文や著作権表示になっていることもあります。

   <p>選択中の副本について、(第 1 層の) メニューの開始位置 を知るには
<code>eb_menu()</code> を使います。
この関数は、副本がメニューを持っていなければ <code>EB_ERR_NO_SUCH_SEARCH</code>
を返しますので、メニューの有無も同時に分かります。
(開始位置は取得せずに、有無だけを調べたいときは、<code>eb_have_menu()</code>
という関数が使えます。)

<pre class="example">     EB_Position position;
     EB_Error_Code err;
     
     err = eb_menu(&amp;book, &amp;position);
     if (err == EB_ERR_NO_SUCH_SEARCH) {
         /* メニューはない */
     } else if (err != EB_SUCCESS) {
         /* それ以外のエラー */
        return;
     }
     </pre>

   <p>後は、得られた位置 (<code>position</code>) にシークして、<code>eb_read_text()</code>
でテキストデータを読み込みます。

   </body></html>

