<html lang="en">
<head>
<title>EB Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="EB Library">
<meta name="generator" content="makeinfo 4.5">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home">
</head>
<body>
<div class="node">
<p>
ノード:<a name="Stop%20Code%20Issue">Stop Code Issue</a>,
次:<a rel="next" accesskey="n" href="Text-Data-Sample.html#Text%20Data%20Sample">Text Data Sample</a>,
前:<a rel="previous" accesskey="p" href="Multi-Candidates.html#Multi%20Candidates">Multi Candidates</a>,
上:<a rel="up" accesskey="u" href="Text-Data.html#Text%20Data">Text Data</a>
<hr><br>
</div>

<h3 class="section">区切りコードの問題</h3>

   <p>本文は、先頭から末尾まで一本の繋がったデータ列になっています。
英語辞典なら、最初の単語 `A' から最後の `zzz' までの説明が、すべて
一つの「本文」の中に書かれることになります。

   <p>一般に、アプリケーションプログラムがある単語を検索した際は、本文の中から
その語を説明した部分だけを抜き出して出力することになるでしょう。
しかし、困ったことに CD-ROM 書籍には、単語の説明の終わりを示す印
(エスケープシーケンス) が定義されていません。
つまり、ある語の説明部分を正確に抜き出すことは、電子ブックや EPWING
では不可能なのです。

   <p>しかしながら、幸いにも市販の書籍の多くには、単語の説明の終了位置にだけ
出現する、特有のエスケープシーケンスが存在します。
もちろん、このエスケープシーケンスは本来「単語の説明の終了」を示すもの
ではなく別の用途として用いるのですが、「終了位置」として代用できる
という意味です。

   <p>EB ライブラリでは、この「終了位置」の印に使えるエスケープシーケンスの
ことを、<dfn>区切りコード (stop code)</dfn> と呼んでいます。
EB ライブラリは区切りコードを自動判定する機能を持っていますが、判定は
完璧ではないので外れることもあります。
外れると本文が途中で途切れたり、本文の続きが延々と出力されたりします。

   <p>その場合は、明示的に appendix
(詳しくは see <a href="../ebappendix-ja/What-is-Appendix.html#What%20is%20Appendix">appendix (付録) とは</a>)
で区切りコードを指定することによって回避できる書籍もありますが、
残念ながら区切りコードがまったく存在しない書籍も少数ながら存在します。
区切りコードを持たない書籍に対して、有効な対処方法は今のところありません。

   <p><code>eb_read_text()</code> による本文の取得では、区切りコードが検出された
時点で読み込みを止めます。
さらに繰り返し <code>eb_read_text()</code> を呼んでも、区切りコードより先の
本文は読み込めません。

   <p>区切りコードを検出したかどうかの判定には、<code>eb_is_text_stopped()</code>
を使います。
この関数は、最後に読み込みを行ったテキストデータの中に、区切りコードを
検出していれば 1 を返します。

   <p>本文以外のテキストデータにも区切りコードの概念は存在しますので、
<code>eb_is_text_stopped()</code> を使って区切りコードを検出できます。
本文以外では EB ライブラリが確実に区切りを判別できますので、誤判定の
問題は起きません。

   <p>見出しにおける区切りは、それぞれの単語の見出しの終了位置となります。
メニューおよび複合検索の候補一覧では、階層化された個々のメニューデータ
の終了位置で区切りと判定されます。
(同一階層に複数個のメニューデータがあっても、個々のメニューデータで
区切られます。)
著作権表示では、全文の終了位置で区切りと判定されます。

   </body></html>

