<html lang="en">
<head>
<title>EB Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="EB Library">
<meta name="generator" content="makeinfo 4.5">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home">
</head>
<body>
<div class="node">
<p>
ノード:<a name="Text%20Data%20Format">Text Data Format</a>,
次:<a rel="next" accesskey="n" href="Hook.html#Hook">Hook</a>,
前:<a rel="previous" accesskey="p" href="Seek-and-Read-Text-Data.html#Seek%20and%20Read%20Text%20Data">Seek and Read Text Data</a>,
上:<a rel="up" accesskey="u" href="Text-Data.html#Text%20Data">Text Data</a>
<hr><br>
</div>

<h3 class="section">テキストデータの内部形式</h3>

   <p>前節の例では、読み込んだテキストデータは、平文テキストになっていました。
けれども、CD-ROM 書籍内に平文テキストのデータが、そのまま収録されている
わけではありません。

   <p>実際のテキストデータの例を、以下に示します。
左側のブロックは 16 進数でダンプした様子で、右側はそれを基に JIS X 0208
(日本語のかな漢字) の文字を表している部分を <code>[　]</code> という形に
直したものです。

<pre class="example">          (16進数によるダンプ)            (可能な部分をかな漢字に変換)
     1f0900011f41010026321f611f042121   1f0900011f410100[Σ]1f611f04[　]
     212721211f053e704a734a541f0a1f04   [：][　]1f05[情][報][編]1f0a1f04
     214e1f0525372530255e1f04214f2121   [［]1f05[シ][グ][マ]1f04[］][　]
     214a237323692367236d236121212370   [（][ｓ][ｉ][ｇ][ｍ][ａ][　][ｐ]
     2372236f236a236523632374214b1f05   [ｒ][ｏ][ｊ][ｅ][ｃ][ｔ][）]1f05
     </pre>

   <p>右側のブロックを見ると、おおよそ平文に近い形でテキストデータが収められて
いることが分かりますが、ところどころに「文字」ではないデータも含まれて
います。

   <p>文字ではない部分は、すべて「エスケープシーケンス」と呼ばれるものです。
エスケープシーケンスとは、テキストデータを出力する際に、改行の禁止や
強調修飾といった制御情報を伝えるための仕組みです。
16 進数の <code>1f</code> が、エスケープシーケンスの開始を意味します。

   <p>参考までに、上のテキストデータで使われているエスケープシーケンスを
すべて列挙すると、次のようになります。

     <dl>
<dt><code>1f09 0001</code>
     <dd>字下げ (インデント) の量を指定。
(引数が 0001 なので、字下げ量は 1。)
<br><dt><code>1f41 0100</code>
     <dd>検索キーの開始。
(引数 0100 の意味については、JIS X 4081 に記述がないため不明。)
<br><dt><code>1f61</code>
     <dd>検索キーの終了。
<br><dt><code>1f04</code>
     <dd>半角表示の開始。
<br><dt><code>1f05</code>
     <dd>半角表示の終了。
<br><dt><code>1f0a</code>
     <dd>改行
</dl>

   <p>前節のプログラムで、読み込んだデータが平文テキストになっていたのは、
実は EB ライブラリが加工処理をしたからです。
つまり、「改行」のように平文テキストでも表現可能なエスケープシーケンス
については処理し、「検索キーの開始」のように表現できないものについては
無視するようにして、平文テキストになるように加工していたのです。

   <p>しかし、平文テキストは表現力が乏しいので、元のデータには含まれている
エスケープシーケンスの多くを無視することになってしまいます。
HTML のように、もっと表現力のある形式で出力するなら、無視せずに済む
シーケンスを増やせそうです。
では、HTML 形式でテキストデータを取得する関数が EB ライブラリに用意されて
いるかというと、残念ながらありません。

   <p>その代わりに、かなり手間はかかりますが、自由にテキストデータを加工できる
ための仕組みが用意されています。
それが、次の節で説明する <dfn>フック (hook)</dfn> です。
フックを使うことで、テキストデータを柔軟に加工することができます。

   </body></html>

